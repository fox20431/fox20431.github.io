# 关于代理后Siri无法使用的解决方案

通过多次试验发现，siri的无法使用和全局代理有关系。

这个问题我发现很久了，但是一直没找到解决方案。

其原因很简单：

1. 因为我对计算机网络造诣不是很深，关于抓包知识了解的更是浅显；
2. V2Ray工具了解不多，对于ISO层模型代理范围不清楚；
3. Siri语音使用的TCP还是UDP传输尚不清楚。

我抛开了上面的所有问题，大胆测测是因为V2Ray工具代理了Siri，至于Packet是什么类型的暂且不管，我只要知道这个包传递给谁，我不使用V2Ray进行代理就OK。

尝试用`tcpdum`命令抓包。

```sh
tcpdump -i en0
```

上面这个命令属于傻瓜式的命令，因为tcpdump文档不少，也没有心思慢慢看下去，即使看完了，其帮助或许也不是大。

为了排除干扰，我把浏览器之类的需要使用带宽的软件的全部关闭，然后点击Siri，随便说一句话，就可以发现tcpdump会捕获很多包。

其实之初我也做到这一步了，但是包太多了，当时懒惰导致我没有看下去。

这次我耐心看下去了，发现其实就两个IP，查了一下对应地理位置，一个是上海市谷歌的数据中心，一个是北京市阿里云的数据中心。

> 39.102.96.186 北京市阿里云 数据中心
> 203.208.41.65 上海市谷歌云 数据中心

Siri点开之后，增加的主要是我的电脑IP与阿里云的数据中心的包，所以我又猜测苹果的Siri和阿里云的数据中心有某些联系。

**经过实践之后上面两个IP不生效，所以通过查阅找到了对应的域名：guzzoni.apple.com。**

打开：

> System preferences > Network > Advanced > Proxies > Bypass proxy settings for here Hosts & Domains

`忽略的主机与域的代理设置`有做配置

不然会有证书问题导致无法连接。

```
*.local, 169.254/16, guzzoni.apple.com
```

